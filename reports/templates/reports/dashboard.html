<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Inventory Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">

{% include 'reports/navbar.html' %}

<div class="container">

  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Excess Inventory</h5>
          <ul class="mb-0">
            {% for p in products %}
              {% if p.is_excess %}
              <li>{{ p.product_num }} - {{ p.item_name }}
                ({{ p.units_sold }} sold / {{ p.quantity_on_hand }} qty â†’ {{ p.excess_qty }} excess)
              </li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Obsolete Inventory 
            <small class="text-muted">(Last Sold 10+ months ago)</small>
          </h5>
          <ul class="mb-0">
            {% for p in products %}
              {% if p.is_obsolete %}
              <li>{{ p.product_num }} - {{ p.item_name }} (Last Sale: {{ p.last_sales_date }})</li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>


<h5 class="mb-3">Inventory Report</h5>

<div class="d-flex justify-content-end align-items-center mb-3 gap-2">
  <button class="btn btn-outline-secondary btn-sm">Filters</button>
  <button class="btn btn-outline-primary btn-sm">Add product/stock</button>
  <button class="btn btn-primary btn-sm">Add new sale</button>
  <button id="downloadSelected" class="btn btn-success btn-sm" disabled>
    <i class="bi bi-download"></i> Download Selected
  </button>
</div>


  <div class="table-responsive shadow-sm rounded">
    <table id="inventoryTable" class="table table-bordered table-hover align-middle text-center mb-0">
      <thead class="table-light">
        <tr>
          <th scope="col"><input type="checkbox" id="selectAll"></th>
          <th scope="col">Product #</th>
          <th scope="col">Item Name</th>
          <th scope="col">Sold</th>
          <th scope="col">Quantity</th>
          <th scope="col">Last Sales Date</th>
          <th scope="col">Excess</th>
          <th scope="col">Obsolete</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for p in products %}
        <tr>
          <td><input type="checkbox" class="row-check"></td>
          <td>{{ p.product_num }}</td>
          <td>{{ p.item_name }}</td>
          <td>{{ p.units_sold }}</td>
          <td>{{ p.quantity_on_hand }}</td>
          <td>{{ p.last_sales_date }}</td>
          <td>{% if p.is_excess %}<span class="badge bg-success">Yes</span>{% else %}<span class="badge bg-secondary">No</span>{% endif %}</td>
          <td>{% if p.is_obsolete %}<span class="badge bg-danger">Yes</span>{% else %}<span class="badge bg-secondary">No</span>{% endif %}</td>
          <td>
            <button class="btn btn-sm btn-outline-warning me-1" title="Edit"><i class="bi bi-pencil"></i></button>
            <button class="btn btn-sm btn-outline-success me-1" title="Archive"><i class="bi bi-archive"></i></button>
            <button class="btn btn-sm btn-outline-secondary" title="More"><i class="bi bi-three-dots"></i></button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="d-flex justify-content-between align-items-center mt-3">
    <small>Rows per page: 5</small>
    <nav>
      <ul id="pagination" class="pagination pagination-sm mb-0"></ul>
    </nav>
  </div>

</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const rowsPerPage = 5;
  const table = document.getElementById("inventoryTable");
  const tbody = table.querySelector("tbody");
  const rows = tbody.querySelectorAll("tr");
  const pagination = document.getElementById("pagination");
  const pageCount = Math.ceil(rows.length / rowsPerPage);

  // === Pagination ===
  function showPage(page) {
    let start = (page - 1) * rowsPerPage;
    let end = start + rowsPerPage;
    rows.forEach((row, i) => {
      row.style.display = (i >= start && i < end) ? "" : "none";
    });
  }

  function setupPagination() {
    pagination.innerHTML = "";
    for (let i = 1; i <= pageCount; i++) {
      let li = document.createElement("li");
      li.className = "page-item";
      li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
      li.addEventListener("click", function (e) {
        e.preventDefault();
        document.querySelectorAll("#pagination .page-item").forEach(item => item.classList.remove("active"));
        li.classList.add("active");
        showPage(i);
      });
      pagination.appendChild(li);
    }
    pagination.firstChild.classList.add("active");
  }

  showPage(1);
  setupPagination();

  // === Checkbox Logic ===
  const selectAll = document.getElementById("selectAll");
  const rowChecks = document.querySelectorAll(".row-check");
  const downloadBtn = document.getElementById("downloadSelected");

  function updateDownloadButton() {
    const checkedRows = document.querySelectorAll(".row-check:checked");
    downloadBtn.disabled = checkedRows.length === 0;
  }

  // Select all
  selectAll.addEventListener("change", function () {
    rowChecks.forEach(cb => cb.checked = selectAll.checked);
    updateDownloadButton();
  });

  // Row checkbox changes
  rowChecks.forEach(cb => {
    cb.addEventListener("change", function () {
      if ([...rowChecks].every(c => c.checked)) {
        selectAll.checked = true;
        selectAll.indeterminate = false;
      } else if ([...rowChecks].some(c => c.checked)) {
        selectAll.checked = false;
        selectAll.indeterminate = true;
      } else {
        selectAll.checked = false;
        selectAll.indeterminate = false;
      }
      updateDownloadButton();
    });
  });

  // Bulk download
  downloadBtn.addEventListener("click", function () {
    const selected = [];
    rowChecks.forEach((cb, i) => {
      if (cb.checked) {
        const productNum = rows[i].children[1].innerText;
        selected.push(productNum);
      }
    });
    alert("Downloading products: " + selected.join(", "));
    // TODO: replace with real download logic
  });

});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
