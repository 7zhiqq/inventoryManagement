<head>
    <meta charset="UTF-8">
    <title>Inventory Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">

{% block content %}

{% include 'reports/navbar.html' %}

<div class="container mt-4">
  <h3 class="mb-3">Full Inventory Report</h3>

  <!-- Action Buttons -->
  <div class="d-flex justify-content-end align-items-center mb-3 gap-2">
    <button class="btn btn-outline-secondary btn-sm">Filters</button>
    <button class="btn btn-outline-primary btn-sm">Add product/stock</button>
    <button class="btn btn-primary btn-sm">Add New Sale</button>
    <button id="downloadSelected" class="btn btn-success btn-sm" disabled>
      <i class="bi bi-download"></i> Download Selected
    </button>
  </div>

  <!-- Table -->
  <div class="table-responsive shadow-sm">
    <table class="table table-bordered align-middle text-center">
      <thead class="table-light">
        <tr>
          <th><input type="checkbox" id="selectAll"></th>
          <th>Product #</th>
          <th>Item Name</th>
          <th>Sold</th>
          <th>Quantity</th>
          <th>Last Sales Date</th>
          <th>Excess</th>
          <th>Obsolete</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for p in page_obj %}
        <tr>
          <td><input type="checkbox" class="rowCheckbox"></td>
          <td>{{ p.product_num }}</td>
          <td>{{ p.item_name }}</td>
          <td>{{ p.units_sold }}</td>
          <td>{{ p.quantity_on_hand }}</td>
          <td>{{ p.last_sales_date }}</td>
          <td>
            {% if p.is_excess %}
              <span class="badge bg-success">Yes</span>
            {% else %}
              <span class="badge bg-secondary">No</span>
            {% endif %}
          </td>
          <td>
            {% if p.is_obsolete %}
              <span class="badge bg-danger">Yes</span>
            {% else %}
              <span class="badge bg-secondary">No</span>
            {% endif %}
          </td>
          <td>
            <button class="btn btn-sm btn-outline-warning me-1" title="Edit"><i class="bi bi-pencil"></i></button>
            <button class="btn btn-sm btn-outline-success me-1" title="Archive"><i class="bi bi-archive"></i></button>
            <button class="btn btn-sm btn-outline-secondary" title="More"><i class="bi bi-three-dots"></i></button>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="9" class="text-center">No inventory found</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center mt-3">
      {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Previous</span></li>
      {% endif %}

      {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
          <li class="page-item active"><span class="page-link">{{ num }}</span></li>
        {% else %}
          <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}
    </ul>
  </nav>
</div>

<!-- Checkbox logic -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const selectAll = document.getElementById("selectAll");
  const checkboxes = document.querySelectorAll(".rowCheckbox");
  const downloadBtn = document.getElementById("downloadSelected");
  const archiveBtn = document.getElementById("archiveSelected");

  function updateButtons() {
    const anyChecked = document.querySelectorAll(".rowCheckbox:checked").length > 0;
    downloadBtn.disabled = !anyChecked;
    archiveBtn.disabled = !anyChecked;
  }

  selectAll.addEventListener("change", () => {
    checkboxes.forEach(cb => cb.checked = selectAll.checked);
    updateButtons();
  });

  checkboxes.forEach(cb => cb.addEventListener("change", updateButtons));
});
</script>

{% endblock %}
